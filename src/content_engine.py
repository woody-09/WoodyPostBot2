import os
import google.generativeai as genai
import re
from datetime import datetime

class ContentEngine:
    def __init__(self, api_key):
        genai.configure(api_key=api_key)
        # ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ gemini-3.0-flash ëª¨ë¸ ì ìš©
        self.model = genai.GenerativeModel('gemini-3.0-flash')

    def recommend_topic(self):
        """
        Geminië¥¼ ì‚¬ìš©í•˜ì—¬ ìµœê·¼ 10ì‹œê°„ ì´ë‚´ì— ì›”ê°€ ëŒ€ë¶€ë“¤ì´ ì–¸ê¸‰í•˜ê³  ë ˆë”§ì—ì„œ í™”ì œê°€ ëœ ê¸°ì—…ì„ ì¶”ì²œë°›ìŠµë‹ˆë‹¤.
        """
        prompt = """
        ë‹¹ì‹ ì€ ê¸ˆìœµ ì‹œì¥ íŠ¸ë Œë“œ ìŠ¤ì¹´ìš°í„°ì…ë‹ˆë‹¤.
        ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” **ë‹¨ í•˜ë‚˜ì˜ ìƒì¥ ê¸°ì—…**ì„ ì°¾ì•„ ì¶”ì²œí•´ì£¼ì„¸ìš”. (S&P 500 ì§€ìˆ˜ í¬í•¨ ê¸°ì—… ìœ„ì£¼)

        **ì¡°ê±´**:
        1. **ìµœê·¼ 10ì‹œê°„ ì´ë‚´**ì— ì£¼ìš” ì›”ê°€ ëŒ€ë¶€(ì˜ˆ: ì›ŒëŸ° ë²„í•, ë§ˆì´í´ ë²„ë¦¬, ë ˆì´ ë‹¬ë¦¬ì˜¤, ìºì‹œ ìš°ë“œ ë“±)ë‚˜ ì €ëª…í•œ ê¸ˆìœµ ê¸°ê´€ì— ì˜í•´ ì–¸ê¸‰ë˜ê±°ë‚˜ ë‰´ìŠ¤ê°€ ë‚˜ì˜¨ ê¸°ì—….
        2. ìœ„ ë‰´ìŠ¤ë¡œ ì¸í•´ í˜„ì¬ Reddit(WallStreetBets, Stocks ë“±)ì´ë‚˜ ì†Œì…œ ë¯¸ë””ì–´ì—ì„œ í™”ì œê°€ ë˜ê³  ìˆëŠ” ê¸°ì—….
        3. **ë©”ì´ì € ë¹…í…Œí¬ ì œì™¸**: NVDA, AAPL, MSFT, AMZN, GOOG, TSLA, META ë“± ì´ë¯¸ ë„ˆë¬´ ìœ ëª…í•œ ì´ˆì €ëª… ê¸°ì—…ì€ ì œì™¸í•œë‹¤. ì˜¤ì§ í•´ë‹¹ ê¸°ì—…ì— ì‹œì¥ì— íŒŒê´´ì ì¸ ì˜í–¥ì„ ì¤„ ë§Œí•œ ëŒ€ê·œëª¨ ì´ìŠˆê°€ ë°œìƒí•œ ê²½ìš°ì—ë§Œ ì˜ˆì™¸ì ìœ¼ë¡œ ì¶”ì²œí•  ìˆ˜ ìˆë‹¤.

        **ê²°ê³¼ë¬¼**:
        ë‹¤ë¥¸ ë§ì€ í•˜ì§€ ë§ê³ , ì˜¤ì§ **ê¸°ì—…ëª…(í‹°ì»¤)** ë§Œ ì¶œë ¥í•˜ì„¸ìš”. (ì˜ˆ: Ford Motor (F))
        ë§Œì•½ í™•ì‹¤í•œ ì •ë³´ê°€ ì—†ë‹¤ë©´, S&P 500 ê¸°ì—… ì¤‘ í˜„ì¬ ì‹œì¥ì—ì„œ ë³€ë™ì„±ì´ í¬ê³  í™”ì œê°€ ë˜ëŠ” ê¸°ì—… í•˜ë‚˜ë¥¼ ì„ ì •í•´ ì£¼ì„¸ìš”.
        """
        try:
            response = self.model.generate_content(prompt)
            # ë¶ˆí•„ìš”í•œ ê³µë°±ì´ë‚˜ ë§ˆì¹¨í‘œ ì œê±°
            topic = response.text.strip()
            return topic
        except Exception as e:
            print(f"\n--- ì£¼ì œ ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ---")
            print(f"Error Type: {type(e).__name__}")
            print(f"Error Details: {str(e)}")
            return "NVIDIA (NVDA)" # ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ê°’

    def generate_content(self, topic):
        """
        [íˆ¬ìë¶„ì„ ë¸”ë¡œê·¸ í†µí•© í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ v3.0]ì„ ìƒëµ ì—†ì´ ì˜¨ì „íˆ ì ìš©í•˜ì—¬ ì½˜í…ì¸ ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        """
        prompt = f"""
        ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ê°€ì¹˜ íˆ¬ì ë¶„ì„ê°€ì…ë‹ˆë‹¤. ì´ë²ˆ ë¶„ì„ ì£¼ì œëŠ” **"{topic}"** ì…ë‹ˆë‹¤. 
        ì•„ë˜ì˜ **[1. ìŠ¤íƒ€ì¼ ê°€ì´ë“œ]**ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì¤€ìˆ˜í•˜ë©´ì„œ, **[2. í†µí•© í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ v3.0]**ì˜ ëª¨ë“  ë‚´ìš©ì„ ìƒëµ ì—†ì´ ë°˜ì˜í•˜ì—¬ ìµœìƒì˜ ê²°ê³¼ë¥¼ ë„ì¶œí•˜ì„¸ìš”.

        ---

        ### 1. ìŠ¤íƒ€ì¼ ê°€ì´ë“œ (ìµœìš°ì„  ì¤€ìˆ˜)
        - **ë¬¸ì²´**: ëª¨ë“  ë¬¸ì¥ì€ ê¸°ë³¸ì ìœ¼ë¡œ **'~ì´ë‹¤'** ì²´(í‰ì„œë¬¸)ë¥¼ ì‚¬ìš©í•œë‹¤.
        - **ì‚¬ê²¬ ë° í†µì°°**: ì¢…ì¢… ê¸€ì˜ íë¦„ì— ë‹¹ì‹ ì˜ ì£¼ê´€ì ì¸ ì‚¬ê²¬ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì„ëŠ”ë‹¤. ì´ëŠ” ë¶ˆí™•ì‹¤í•œ ì¸ì‚¬ì´íŠ¸ì—¬ë„ ê´œì°®ë‹¤.
           - ê°œì¸ì ì¸ ê²½í—˜ì„ ë…¹ì—¬ë‚¸ 1ì¸ì¹­ ê´€ì°°ì ì‹œì ì˜ ë¬¸ì²´ë¥¼ ì‚¬ìš©í•˜ë¼. ë¬¸ì¥ì€ í™”ë ¤í•˜ì§€ ì•Šê³  ìˆ˜ìˆ˜í•´ì•¼ì•¼ í•œë‹¤. í•´ë‹¹ ë¬¸ì¥ì€ ì–´ë‘ìš´íšŒìƒ‰ ìƒ‰ìƒìœ¼ë¡œ í‘œì‹œí•œë‹¤ íƒœê·¸ë¡œ ê°ì‹¸ì„œ ì·¨ì†Œì„  ì²˜ë¦¬í•œë‹¤.
        - **ì˜ì–´ ë¼ë²¨ ê¸ˆì§€**: ë³¸ë¬¸ì˜ ì†Œì œëª©(Header)ì´ë‚˜ ì„¹ì…˜ êµ¬ë¶„ ì‹œ "Stage 1", "Phase 1"ê³¼ ê°™ì´ ì˜ì–´ë¡œ ë‹¨ê³„ë¥¼ ëª…ì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤. ì˜¤ì§ í•œêµ­ì–´ ì œëª©ë§Œ ì‚¬ìš©í•œë‹¤.
        - **í˜ë¥´ì†Œë‚˜ ì–¸ê¸‰ ê¸ˆì§€**: ë³¸ë¬¸ì—ì„œ "ë‚˜ëŠ” ì‹ ì¤‘í•œ ì—­ë°œìƒ íˆ¬ììì´ë‹¤"ì™€ ê°™ì´ ìì‹ ì˜ ì •ì²´ì„±ì„ êµ¬êµ¬ì ˆì ˆ ë°íˆì§€ ì•ŠëŠ”ë‹¤. ì˜¤ì§ ë¶„ì„ì˜ ê¹Šì´ë¡œ ì¦ëª…í•œë‹¤.
        - **íˆ¬ìì˜ê²¬ ì¡°ì ˆ**: ì˜ê²¬ì„ ë„ˆë¬´ ê°•ìš”í•˜ê±°ë‚˜ í™•ì •ì ìœ¼ë¡œ ë§í•˜ì§€ ë§ê³ , **ì‹ ì¤‘í•˜ê³  ë³´ìˆ˜ì ì¸ ê´€ì **ì—ì„œ ë¶€ë“œëŸ½ê²Œ í‘œí˜„í•œë‹¤.
        - **ì˜ë¬¸ ë³‘ê¸° ê¸ˆì§€**: ê´„í˜¸ ì•ˆì— ë¶ˆí•„ìš”í•œ ì˜ë¬¸ ë²ˆì—­ ëª…ì¹­ì„ ë„£ì§€ ì•ŠëŠ”ë‹¤. ê¼­ í•„ìš”í•œ ê²½ìš°ë¥¼ ì œì™¸í•˜ê³ ëŠ” í•œêµ­ì–´ë§Œ ì‚¬ìš©í•œë‹¤.
        - **ìš©ì–´ ì‚¬ìš© ì£¼ì˜**: 'ì•…ë§ˆì˜ ë³€í˜¸ì¸'ì´ë¼ëŠ” ë‹¨ì–´ë¥¼ ë³¸ë¬¸ì— ì§ì ‘ ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  ë¦¬ìŠ¤í¬ ë¶„ì„, ë°˜ë¡ , í˜¹ì€ 'ê³ ë ¤í•´ì•¼ í•  ìœ„í—˜ ìš”ì†Œ' ë“±ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í‘œí˜„í•œë‹¤.

        ---

        ### 2. í†µí•© í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ v3.0

        ## ì‹œìŠ¤í…œ ê°œìš”
        ### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
        ```
        Layer 1: Design System Foundation (ë””ìì¸ ì² í•™ ë° CSS ì •ì˜)
            â†“
        Layer 2: HTML Structure Framework (êµ¬ì¡° ì›ì¹™ ë° í…œí”Œë¦¿)
            â†“
        Layer 3: Content Generation Engine (ì½˜í…ì¸  ìƒì„± ë¡œì§)
        ```
        ### í•µì‹¬ ëª©í‘œ
        - **ì‹ ë¢°ì„±**: ì „ë¬¸ì ì´ê³  ì •í™•í•œ íˆ¬ì ì •ë³´ ì œê³µ
        - **ì¼ê´€ì„±**: í†µì¼ëœ ë””ìì¸ê³¼ êµ¬ì¡°ë¡œ ë¸Œëœë“œ êµ¬ì¶•
        - **íš¨ìœ¨ì„±**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í…œí”Œë¦¿ê³¼ ìë™í™”

        ---

        ## Layer 1: Design System Foundation
        ### 1.1 ë””ìì¸ ì² í•™
        ### ğŸ¨ ê¸°ë³¸ ê¸°ì¡°
        > "ì‹ ë¢°ë¥¼ í†µí•œ ì„¤ë“" - ë³µì¡í•œ ê¸ˆìœµ ì •ë³´ë¥¼ ë‹¨ìˆœí•˜ê³  ëª…í™•í•˜ê²Œ ì „ë‹¬
        ### ğŸ“ ë””ìì¸ 3ëŒ€ ì›ì¹™
        1. **Minimal Complexity**: ë³µì¡í•œ ê¸ˆìœµ ì •ë³´ë¥¼ ë‹¨ìˆœí•˜ê³  ëª…í™•í•˜ê²Œ
        2. **Data-First but easy readable**: ê°€ë…ì„± ì¢‹ê³  ê¸ì •/ë¶€ì •ì´ í•œëˆˆì— ë“¤ì–´ì˜¤ê²Œ í•¨
        3. **Trust Through Consistency**: ì¼ê´€ì„±ìœ¼ë¡œ ì „ë¬¸ì„± êµ¬ì¶•
        ### ğŸ¨ ìƒ‰ìƒ ì² í•™
        - **Primary (ë„¤ì´ë¹„/ë¸”ë£¨)**: ì‹ ë¢°ì™€ ì•ˆì •ì„±
        - **Semantic (ê·¸ë¦°/ë ˆë“œ)**: ì§ê´€ì  ì •ë³´ ì „ë‹¬
        - **Neutral (ê·¸ë ˆì´)**: ì •ë³´ ê³„ì¸µ êµ¬ë¶„
        - **ì›ì¹™**: 5ê°œ ì´í•˜ ì£¼ìš” ìƒ‰ìƒì„ ì¶©ë¶„íˆ í™œìš©
        ### âœï¸ íƒ€ì´í¬ê·¸ë˜í”¼ ì›ì¹™
        - **ê°€ë…ì„± ìš°ì„ **: ë³¸ë¬¸ 16px+, í–‰ê°„ 1.75
        - **ìˆ«ì ì „ìš©**: ê¸ˆìœµ ë°ì´í„°ëŠ” ê³ ì •í­ í°íŠ¸
        - **ê³„ì¸µ ëª…í™•ì„±**: ì œëª©:ë¶€ì œ:ë³¸ë¬¸ = 2:1.5:1

        ### 1.2 CSS ë³€ìˆ˜ ì²´ê³„
        ### ìƒ‰ìƒ ì‹œìŠ¤í…œ
        ```css
        :root {{
          --color-primary: #1A1A2E;         /* ë‹¤í¬ ë„¤ì´ë¹„ */
          --color-secondary: #0F4C75;       /* ë”¥ ë¸”ë£¨ */
          --color-accent-positive: #16C79A; /* ìƒìŠ¹ */
          --color-accent-negative: #FF6B6B; /* í•˜ë½ */
          --color-background: #FFFFFF;
          --color-text-primary: #2C3E50;
        }}
        ```
        ### íƒ€ì´í¬ê·¸ë˜í”¼ ì‹œìŠ¤í…œ
        ```css
        :root {{
          --font-primary: -apple-system, "Noto Sans KR", sans-serif;
          --font-mono: "SF Mono", Monaco, monospace;
          --text-base: 1rem;     /* 16px */
          --text-lg: 1.125rem;   /* 18px */
          --text-xl: 1.5rem;     /* 24px */
        }}
        ```
        ### 1.3 ì»´í¬ë„ŒíŠ¸ ì •ì˜
        ### í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ëª©ë¡
        - `.tst-stock-info` - ì¢…ëª© ì •ë³´ í—¤ë”
        - `.key-points-list` - í•µì‹¬ í¬ì¸íŠ¸ ë¦¬ìŠ¤íŠ¸
        - `.rating` - íˆ¬ì ë“±ê¸‰ ë°°ì§€
        - `.tst-financial-table` - ì¬ë¬´ í…Œì´ë¸”
        - `.trend-{{up|down|neutral}}` - íŠ¸ë Œë“œ ì¸ë””ì¼€ì´í„°
        - `.metric-card` - ì§€í‘œ ì¹´ë“œ

        ---

        ## Layer 2: HTML Structure Framework
        ### 2.1 êµ¬ì¡° ì„¤ê³„ ì² í•™
        ### ğŸ“‹ êµ¬ì¡° ì„¤ê³„ 4ëŒ€ ì›ì¹™
        1. **Platform Awareness**: ìŠ¤í‚¨ ì‹œìŠ¤í…œ ì¶©ëŒ ë°©ì§€, ì—ë””í„° ìë™ ë³€í™˜ ëŒ€ì‘
        2. **Performance First**: 3ì´ˆ ì´ë‚´ ë¡œë”© ëª©í‘œ, ì´ë¯¸ì§€ ìµœì í™” í•„ìˆ˜
        3. **Reader Centric**: ê°€ë…ì„± ìµœìš°ì„ , ì ë‹¹í•œ ìƒì§•ìƒ‰/ëŒ€ë¹„ìƒ‰ í™œìš©
        4. **Regulatory Compliance**: ë©´ì±…ì¡°í•­ í•„ìˆ˜ í¬í•¨, íˆ¬ìê¶Œìœ  ì˜¤í•´ ë°©ì§€
        5. **EEAT**: EEATì¶©ì¡±ì„ ìœ„í•´ ë‹¤ìŒ ë‚´ìš©ì˜ í‘¸í„°ë¥¼ ë„£ì–´ì£¼ì„¸ìš”. ì‘ì„±ì:ìš°ë””(Woody), ì´ë ¥:ê²½ì œì  ììœ ë¥¼ í–¥í•´ ë‚˜ì•„ê°€ëŠ” 5ë…„ ì°¨ ì‹¤ì „ íˆ¬ììì…ë‹ˆë‹¤. AIë¥¼ í™œìš©í•´ ë§¤ì¼ ê²½ì œ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ìˆ˜ì§‘/ë¶„ì„í•©ë‹ˆë‹¤. ì œê°€ íˆ¬ììë¡œì„œ ì„±ì¥í•´ê°€ëŠ” ê³¼ì •ì„ ë¸”ë¡œê·¸ì— ê¸°ë¡í•˜ê³  ìˆìœ¼ë©°, ë¶€ì¡±í•œ ì •ë³´ë¼ë„ ê³µìœ ë¥¼ í†µí•´ ì¸ì‚¬ì´íŠ¸ë¥¼ ì–»ìœ¼ì‹¤ ìˆ˜ ìˆë‹¤ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. 


        ### 2.2 5-Phase í…œí”Œë¦¿ êµ¬ì¡°
        ```
        Phase 1: Meta Header (ë©”íƒ€ë°ì´í„°)
            â”œâ”€ ê¸°ì—… ì‹ë³„ ì •ë³´
            â”œâ”€ í•µì‹¬ íˆ¬ì í¬ì¸íŠ¸
            â””â”€ íˆ¬ì ë“±ê¸‰ ë°°ì§€
        Phase 2: Navigation (ëª©ì°¨)
            â””â”€ ì¡°ê±´ë¶€ ìë™ ìƒì„±
        Phase 3: Main Content (ë³¸ë¬¸)
            â”œâ”€ Executive Summary
            â”œâ”€ ì¬ë¬´ ë¶„ì„
            â”œâ”€ ë°¸ë¥˜ì—ì´ì…˜
            â””â”€ ë¦¬ìŠ¤í¬ ìš”ì¸
        Phase 4: Compliance Footer (í‘¸í„°)
            â”œâ”€ ë©´ì±…ì¡°í•­
            â””â”€ ì—…ë°ì´íŠ¸ ì •ë³´
        Phase 5: Inline Styles (ìŠ¤íƒ€ì¼)
            â””â”€ ìŠ¤ì½”í”„ í•œì • CSS
        ```

        ---

        ## Layer 3: Content Generation Engine
        ### 3.1 ì—­í•  ì •ì˜
        ### ğŸ‘¤ í˜ë¥´ì†Œë‚˜
        **'Prudent Contrarian'** - 20ë…„ ê²½ë ¥ ê°€ì¹˜íˆ¬ì ì• ë„ë¦¬ìŠ¤íŠ¸
        ### ğŸ§  3ì¤‘ ì‚¬ê³  ëª¨ë“œ
        ```
        Primary Mode: ë³´ìˆ˜ì  ê°€ì¹˜íˆ¬ìì (ìë³¸ ë³´ì¡´)
             â†“â†‘
        Shadow Mode: ì„±ì¥íˆ¬ìì ê´€ì  (ê¸°íšŒë¹„ìš©)
             â†“â†‘
        Meta Mode: í†µí•©ì  ì§€í˜œ
        ```
        ### 3.2 6ë‹¨ê³„ ë¶„ì„ í”„ë ˆì„ì›Œí¬
        ### ğŸ“Š Stage 1: ê¸°ì—… ë³¸ì§ˆ ë¶„ì„
        - ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ ëª…í™•í™”, Porter's Five Forces í‰ê°€, ëŒ€ì²´ ë¶ˆê°€ëŠ¥ì„± ê²€ì¦, ê²½ì˜ì§„ íŠ¸ë™ë ˆì½”ë“œ, ì‹œì¥ì ìœ ìœ¨ ì¶”ì´
        ### ğŸ“ˆ Stage 2: ì¬ë¬´ ê±´ì „ì„± ë¶„ì„
        - 3ì¤‘ ê²€ì¦ ì‹œìŠ¤í…œ (ì‹œê³„ì—´ ë¶„ì„, ë™ì¢…ì—…ê³„ ë¹„êµ, ì ˆëŒ€ê°’ í‰ê°€)
        - í•µì‹¬ ì§€í‘œ: ROE > 15%, ì˜ì—…ì´ìµë¥  > ì—…ê³„í‰ê· , FCF Margin > 10%, ë¶€ì±„ë¹„ìœ¨ < 100%, ìœ ë™ë¹„ìœ¨ > 150%, ì´ìë³´ìƒë°°ìœ¨ > 3x, ë§¤ì¶œ CAGR(3Y) > 10%, EPS ì„±ì¥ë¥  > 15%
        ### ğŸ¯ Stage 3: ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„
        - í™•ë¥  ê°€ì¤‘ ì‹œë‚˜ë¦¬ì˜¤: Bull(25%, +40~50%), Base(60%, +10~20%), Bear(15%, -20~30%)
        - ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤ í™œìš©
        ### ğŸ’° Stage 4: ë°¸ë¥˜ì—ì´ì…˜ ì¢…í•©
        - DCF ëª¨ë¸ êµ¬ì„± (ë§¤ì¶œ ì˜ˆì¸¡, ë¹„ìš© êµ¬ì¡°, FCF, WACC, í„°ë¯¸ë„ ë°¸ë¥˜)
        - ëª©í‘œì£¼ê°€ ë„ì¶œ: DCF(40%), P/E(20%), P/B(20%), EV/EBITDA(20%) ê°€ì¤‘ì¹˜ ì ìš© ë° ì•ˆì „ë§ˆì§„ 10% ì ìš©
        ### ğŸ¯ Stage 5: íˆ¬ì ì˜ì‚¬ê²°ì •
        - íˆ¬ì ë§¤ë ¥ë„ ìŠ¤ì½”ì–´ì¹´ë“œ (100ì  ë§Œì ): ì‚¬ì—…(30), ì¬ë¬´(25), ë°¸ë¥˜(25), ì„±ì¥(20)
        - íˆ¬ìì˜ê²¬: STRONG BUY(80-100), BUY(60-79), HOLD(40-59), SELL(20-39), STRONG SELL(0-19)
        ### ğŸ” Stage 6: ë©”íƒ€ì¸ì§€ ê²€ì¦
        - í¸í–¥ ì ê²€ (í™•ì¦, ìµœì‹ ì„±, ì•µì»¤ë§, ê³¼ì‹ ) ë° í’ˆì§ˆ ê²€ì¦ 10ê³„ëª… ì¤€ìˆ˜

        ### 3.3 ì¶œë ¥ ê·œê²©
        ### ğŸ“ ì„¹ì…˜ë³„ ë¶„ëŸ‰ ê¸°ì¤€
        - Summary: 300-500ì
        - ì¬ë¬´ë¶„ì„: 1,500ì+
        - ë°¸ë¥˜ì—ì´ì…˜: 1,500ì+
        - ë¦¬ìŠ¤í¬: 1,000ì+
        - ì „ëµ: 800ì+
        ### ğŸ“Š í•„ìˆ˜ ì‹œê°í™” ìš”ì†Œ
        - í…Œì´ë¸”: 3ê°œ+
        - ì°¨íŠ¸: 1ê°œ+
        - ë©”íŠ¸ë¦­ì¹´ë“œ: 2ê°œ+
        - íŠ¸ë Œë“œì§€í‘œ: 1ê°œ+

        ---

        **í˜•ì‹ ìš”êµ¬ì‚¬í•­**:
        - ì¶œë ¥ í˜•ì‹: HTML (body ë‚´ìš©ë§Œ ì‘ì„±, <html> ë˜ëŠ” <body> íƒœê·¸ ì œì™¸)
        - **íƒœê·¸**: ë§¨ ë§ˆì§€ë§‰ì— <div id="tags" style="display:none">tag1, tag2, ...</div>ì™€ ê°™ì€ ìˆ¨ê²¨ì§„ div ì•ˆì— ê´€ë ¨ íƒœê·¸ 10-20ê°œë¥¼ ë„£ìœ¼ì„¸ìš”.

        **ì£¼ì œ**: {topic}
        **ë‚ ì§œ**: {datetime.now().strftime('%Y-%m-%d')}
        """

        try:
            response = self.model.generate_content(prompt)
            return response.text
        except Exception as e:
            print(f"\n--- ì½˜í…ì¸  ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ ---")
            print(f"Error Type: {type(e).__name__}")
            print(f"Error Details: {str(e)}")
            return None


    def extract_tags(self, html_content):
        """
        ìˆ¨ê²¨ì§„ divì—ì„œ íƒœê·¸ë¥¼ ì¶”ì¶œí•˜ê³ , ë³¸ë¬¸ ë‚´ì˜ í•´ì‹œíƒœê·¸(#Keyword)ë„ ê°ì§€í•˜ì—¬ ë¼ë²¨ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.
        CSS ìƒ‰ìƒ ì½”ë“œ(ì˜ˆ: #ffffff, #333)ëŠ” ì œì™¸í•©ë‹ˆë‹¤.
        """
        tags = []
        import re

        # 1. ìˆ¨ê²¨ì§„ Divì—ì„œ íƒœê·¸ ì¶”ì¶œ (ê¸°ì¡´ ë¡œì§)
        match = re.search(r'<div id="tags"[^>]*>(.*?)</div>', html_content, re.DOTALL)
        if match:
            tags_str = match.group(1)
            # ê¹”ë”í•˜ê²Œ ì •ë¦¬í•˜ë©° ì¶”ê°€
            for t in tags_str.split(','):
                tag = t.strip()
                if tag and not re.match(r'^[0-9a-fA-F]{3,6}$', tag):
                    tags.append(tag)

        # 2. ë³¸ë¬¸ ë‚´ í•´ì‹œíƒœê·¸ ì¶”ì¶œ (ì˜ˆ: #ë°˜ë„ì²´ #íˆ¬ì)
        # í—¥ì‚¬ ì½”ë“œ í˜•ì‹(#ffffff)ì€ ì œì™¸í•˜ê¸° ìœ„í•´ ì•ì— ê³µë°±ì´ë‚˜ ì‹œì‘ì ì´ ìˆê³  ë’¤ì— ë¬¸ìê°€ ì˜¤ëŠ” íŒ¨í„´ ì‚¬ìš©
        hashtags = re.findall(r'(?:^|\s)#(\w+)', html_content)
        for ht in hashtags:
            # ìˆ«ìë¡œë§Œ ì´ë£¨ì–´ì§„ 3ìë¦¬ ë˜ëŠ” 6ìë¦¬ (ìƒ‰ìƒ ì½”ë“œ ê°€ëŠ¥ì„±) ì œì™¸
            if not re.match(r'^[0-9a-fA-F]{3,6}$', ht):
                tags.append(ht)

        # ì¤‘ë³µ ì œê±° ë° ë¹ˆ ë¬¸ìì—´ ì œê±°
        unique_tags = list(dict.fromkeys([t for t in tags if t]))
        
        # Blogger API ë¼ë²¨ ì œí•œ (ë³´í†µ 20ê°œ ë‚´ì™¸ê°€ ì•ˆì „)
        return unique_tags[:20]

    def clean_html(self, html_content):
        """
        ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ì´ë‚˜ ë¶ˆí•„ìš”í•œ ê³µë°±ì„ ì •ë¦¬í•©ë‹ˆë‹¤.
        """
        cleaned = html_content.strip()
        # ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ì œê±°
        cleaned = re.sub(r'^```html\s*', '', cleaned, flags=re.IGNORECASE)
        cleaned = re.sub(r'\s*```$', '', cleaned)
        return cleaned.strip()
